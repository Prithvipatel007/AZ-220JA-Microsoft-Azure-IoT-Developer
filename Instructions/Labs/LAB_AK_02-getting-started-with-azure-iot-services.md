---
lab:
    title: 'ラボ 02: Azure IoT Services の使用を開始'
    module: 'モジュール 1: IoT と Azure IoT Services サービスの紹介'
---

# Azure  IoT Services の開始

## ラボ シナリオ

あなたは、グルメチーズを製造し販売する会社である Contoso で働く Azure IoT 開発者です。あなたは、会社が導入する予定の IoT ソリューションで使用する Azure および Azure IoT サービスのエクスペリエンスを担当します。Azure portal を理解し、プロジェクトのリソース グループを作成しました。次に、Azure IoT サービスの調査を開始する必要があります。

## このラボでは

このラボでは、ソリューション (IoT Hub および IoT Hub Device Provisioning Service) のプロビジョニングと IoT デバイスの接続に使用される Azure IoT サービスの探検を開始します。ラボには、次の演習が含まれます。

* 一意の名前を持つリソースの名前付け
* Azure portal を使用して IoT ハブを作成する
* IoT ハブサービスの機能を確認する
* Device Provisioning Service を作成し、IoT ハブにリンクする
* Device Provisioning Service の機能を確認する

## ラボの手順

### 演習 1: 一意の名前を持つリソースの名前付け

このコースでは、リソースを作成します。ラボ全体で一貫性を保つために、リソースを使い終わるたびにリソースを整理し、使用する必要がある名前を提供します。ただし、これらのリソースの多くは、Web で使用できるサービスを公開しているため、グローバルに一意の名前を持つ必要があります。これを実現するには、リソース名の末尾に追加される一意識別子を使用します。一意の ID を作成しましょう。

#### 一意の ID

一意の ID は、次のパターンを使用して、イニシャルと現在の日付を使用して作成されます。

```text
YourInitialsYYMMDD
```

したがって、イニシャルの後に、現在の年の最後の 2 桁、現在の数値月、および現在の数値日が続きます。以下にいくつかの例を示します。

```text
GWB200123
BHO200504
CAH201216
DM200911
```

場合によっては、一意の ID の小文字のバージョンを使用するように求められることがあります。

```text
gwb200123
bho200504
cah201216
dm200911
```

一意の ID を使用する必要がある場合は、必ず `{YOUR-ID}` と表示されます。文字列全体 (`{}` を含む) を一意の値に置き換えます。

一意の ID をメモし、 **コース全体で同じ値を使用して** - 毎日日付を更新しません。 

リソースの例と、それらに関連付けられている名前を見てみましょう。

#### リソース グループ

リソース グループは、サブスクリプション内で一意の名前を持つ必要があります。ただし、グローバルに一意である必要はありません。したがって、このコースでは、リソース グループ名を使用します。**rg-az220**。

  > **情報:** リソース グループ名  - **rg-az220**

#### 公開可能なリソース

作成するリソースの多くは、パブリックにアドレス指定可能な (セキュリティで保護された) エンドポイントを持つため、グローバルに一意である必要があります。このようなリソースの例としては、IoT Hub、Device Provisioning Services、Azure Storage Accounts などがあります。これらの各ユーザーには名前テンプレートが提供され、`{YOUR-ID}` を一意の ID に置き換える必要があります。以下にいくつかの例を示します。

一意の ID が次の場合: **CAH191216**

| リソースの種類:  | 名前テンプレート | 例 |
| :--- | :--- | :--- |
| IoT Hub | iot-az220-training-{your-id} | AZ-220-HUB-CAH191216 |
| デバイス プロビジョニング サービス | dps-az220-training-{your-id} | AZ-220-DPS-CAH191216 |
| Azure ストレージ アカウント<br/>(名前は小文字で、ダッシュは使用できません) | az220storage_{YOUR-ID}_ | az220storagecah191216 |

また、Bash スクリプトと C# ソース ファイル内の値を更新するだけでなく、Azure Portal UI に名前を入力する必要があります。以下にいくつかの例を示します。

```bash
#!/bin/bash

YourID="{YOUR-ID}"
RGName="rg-az220"
IoTHubName="AZ-220-HUB-$YourID"

```

`YourID="{YOUR-ID}"` を `YourID="CAH191216"` に更新する必要があることに注意 - `$YourID` を変更しないでください。同様に、C# では次のように表示されます。

```csharp
private string _yourId = "{YOUR-ID}";
private string _rgName = "rg-az220";
private string _iotHubName = $"AZ-220-HUB-{_yourId}";
```

繰り返しますが、`private string _yourId = "{YOUR-ID}";` は `private string _yourId = "CAH191216";` に更新する必要があります -  `_yourId` に変更しないでください。

### 演習 2: Azure portal を使用して IoT ハブを作成する

Azure IoT Hub は、IoT デバイスと Azure の間で信頼性とセキュリティで保護された双方向通信を実現するフルマネージド サービスです。Azure IoT Hub サービスでは、次の機能が提供されます。

* 数十億台の IoT デバイスと双方向通信を確立
* 一方向メッセージング、ファイル転送、要求/応答方式など、複数の device-to-cloud への通信オプションと cloud-to-device への通信オプション。
* 他の Azure サービスへの組み込みの宣言型メッセージ ルーティング。
* デバイス メタデータと同期状態情報のクエリ可能なストア。
* デバイスごとのセキュリティ キーまたは X.509 証明書を使用して、通信とアクセス コントロールを保護します。
* デバイス接続性とデバイス ID 管理イベントの広範囲のモニタリング。
* 最も一般的な言語とプラットフォームの SDK デバイス ライブラリ。

IoT ハブの作成には、いくつかの方法を使用できます。たとえば、Azure portal を使用して IoT ハブ リソースを作成できます。これは、このタスクで実行します。ただし、プログラムによって IoT ハブ (およびその他のリソース) を作成することもできます。このコースでは、Azure CLI や PowerShell など、Azure リソースの作成と管理に使用できる追加の方法について調査します。

#### タスク 1: Azure portal を使用して リソース (IoT Hub) を作成する

1. Azure アカウントの資格情報を使用して [portal.azure.com](https://portal.azure.com) にログインします。

    複数の Azure アカウントをお持ちの場合は、このコースで使用するサブスクリプションに関連付けられているアカウントでログインしていることを確認してください。  間違ったアカウントをうっかり使用するのを避ける最も簡単な方法は、InPrivate /匿名のブラウザー セッションを使用することです。

1. 前のタスクで作成した AZ-220 ダッシュボードが読み込まれています。

    コースが進むにつれて、ダッシュボードにリソースを追加します。

1. Azure portal で、「**+ リソースの作成**」 をクリックします。

    Azure Marketplace は、Azure で作成できるすべてのリソースのコレクションです。Marketplace には、Microsoft とコミュニティの両方からのリソースが含まれています。

1. Search テキストボックスで**IoT**を入力し、**Enter**を押します。

    > **注意**: 非公開の貢献者が提供する Marketplace サービスには、Microsoft Azure Pass またはその他の Microsoft クレジット オファリングの対象外のコストが含まれる場合があります。

1. 「Search 結果」ブレードで、「**IoT Hub**」をクリックします。

    このブレードに表示される「_役に立つリンク_」の一覧に注目してください。

1. リンクの一覧に、ドキュメントへのリンクがあることに注意してください。

    このドキュメントを今すぐ調べる必要はありませんが、注目に値します。_IoT Hubドキュメント_ページは、IoT Hubのリソースとドキュメントのルート ページです。  このページを使用して、現在のドキュメントを詳しく調査すると、このコースの範囲外のアクティビティを探索するのに役立つチュートリアルやその他のリソースを見つけることができます。特定のトピックの詳細については、このコースで docs.microsoft.com サイトを参照してください。

    ドキュメント リンクを開いた場合は、ブラウザーを使用してドキュメント タブを閉じ、Azure portal タブに戻ります。

#### タスク 2: 必要なプロパティ設定を使用して IoT Hubを作成する

1. 新しい IoT の作成プロセスを開始するには、「**作成**」をクリックします。 

    >**ヒント:** 今後、Azure リソースの種類の _作成_ エクスペリエンスを実現する方法は、他に 2 つあります。
        1. お気に入りにサービスがある場合は、サービスをクリックしてインスタンスのリストに移動し、上部の「_+ 追加_」 ボタンをクリックします。
        2. ポータルの上部にある「_Search_」ボックスでサービス名を検索して、インスタンスの一覧に移動し、上部の「_+ 追加_」ボタンをクリックします。 

    次に、ハブとサブスクリプションに関する情報を指定する必要があります。次の手順では、各フィールドの入力を説明しながら、設定をウォークスルーします。

1. 「_IoT ハブ_」ブレードの「_基本_」タブで、このコースで使用する Azure 「**サブスクリプション**」が選択されていることを確認します。     

1. 「**リソース グループ**」の右側にある「**既存の選択**」ドロップダウンを開き、「**rg-az220**」 をクリックします。   

    これは、前のラボで作成したリソース グループです。このコースで作成したリソースを、同じリソース グループにまとめます。これは、コースを修了した時点でリソースをクリーンアップするのに役立ちます。

1. 「**リージョン**」の右側にあるドロップダウン リストを開き、リソース グループと同じリージョンを選択します。   

    > **注意**:  Event Grid がサポートされていることを確認します。Event Grid をサポートするリージョンの現在のリストについては、次のリンクを参照してください。[リージョン別利用可能な製品](https://azure.microsoft.com/ja-jp/global-infrastructure/services/?products=event-grid&regions=all)

    以前、見たように、Azure は世界各地における一連のデータセンターでサポートされています。Azure で何かを作成する場合は、これらのデータセンターの場所のいずれかにデプロイします。

    > **注意**:  アプリをホストするリージョンを選択する場合、エンド ユーザーに近いリージョンを選択すると、読み込み/応答時間が減少することに注意してください。エンド ユーザーから世界の反対側にいる場合は、最も近いリージョンを選択しないでください。

1. 「**IoT Hub名**」の右側に、IoT Hub のグローバルに一意な名前を入力します。 

    グローバルに一意の名前を指定するには、 **iot-az220-training-{your-id}** (と入力します **_{YOUR-ID}_** をラボ 1 で作成した一意の ID に置き換えることを忘れないでください)。 

    例: **AZ-220-HUB-CAH191021**

    IoT ハブの名前は、パブリックにアクセス可能なリソースなので、IP接続されたどのデバイスからでもアクセスできる、グローバルに一意である必要があります。

    新しい IoT ハブに一意の名前を指定する場合は、次の点を考慮してください。

    * _IoT ハブ名_ に適用する値は、すべての Azure で一意である必要があります。  これは、名前に割り当てられた値が IoT ハブの接続文字列で使用されるためです。Azure では世界中のどこからでもデバイスをハブに接続できるため、すべての Azure ハブは、接続文字列を使用してインターネットからアクセスできる必要があり、したがって接続文字列は一意である必要があります。このラボでは、後で接続文字列について説明します。

    * _IoT ハブ名_ に割り当てる値は、アプリ サービスの作成後に変更することはできません。  名前を変更する必要がある場合は、新しい IoT ハブを作成し、デバイスを再登録して、古い IoT ハブを削除する必要があります。

    * _IoT ハブ名_ フィールドは必須フィールドです。

    > **注意**:  入力した名前が一意であることを Azure が確認します。入力した名前が一意でない場合、Azure は警告として名前フィールドの最後にアスタリスクを表示します。グローバルに一意な名前を得るために必要に応じて、上記の名前に '**-01**' または '**-02**' をアペンドすることができます。

1. ブレードの上部にある**管理**をクリックします。

    このブレードに表示される情報を確認してください。

1. 「スケーリング レベルとユニット」の右側で、ドロップダウンを開いて「**S1**」を選択します。

    必要な機能の数と、1 日にソリューションを通じて送信するメッセージの数に応じて、複数の階層オプションから選択できます。このコースで使用する_S1_ 階層では、1 日あたり合計 400,000 件のメッセージを受信でき、このトレーニングに必要なすべてのサービスを提供します。  実際には 1 日あたり 400,000 メッセージは必要ありませんが、 _Cloud-to-device コマンド_、_デバイス管理_、および_IoT Edge_など、この階層レベルで提供される機能を使用します。また、IoT ハブは、テストと評価用の Free レベルも提供します。Standard 階層のすべての機能を持っていますが、メッセージングの許容量は限られています。ただし、Free レベルから Basic レベルまたは Standard レベルにアップグレードすることはできません。Free レベルは、テストと評価を目的としています。この機能により、500 台のデバイスを IoT ハブに接続でき、1 日あたり最大 8,000 件のメッセージを送信できます。各 Azure サブスクリプションは、Free レベル内に 1 つの IoT ハブを作成できます。

    > **注意**:   _S1 - Standard_ 階層のコストは、単位あたり月額 25.00 米国ドルです。  1台指定します。その他の階層オプションの詳細については、[ソリューションに適した IoT ハブ階層の選択](https://docs.microsoft.com/ja-jp/azure/iot-hub/iot-hub-scaling)を参照してください。 

1. 「**S1 IoT ハブ ユニットの数**」の右側で 「**1**」 が選択されていることを確認します。

    前述のように、選択した価格レベルによって 1 日あたりにハブが 1 つの単位で処理できるメッセージの数が設定されます。高い価格レベルに移行せずにハブで処理できるメッセージの数を増やすには、単位数を増やします。たとえば、IoT ハブで 800,000 メッセージのイングレスをサポートする場合は *2 つの*S1 階層単位を選択します。  Microsoft が作成した IoT コースでは、1 つの単位のみを使用します。

1. **Defender for IoT**で、「**オフ**」を選択します。

    Defender for IoT は、セキュリティ管理を統一し、ハイブリッド クラウド ワークロードと Azure IoT ソリューション全体でエンド ツー エンドの脅威検出と分析を可能にします。Defender for IoT については、後のラボで説明しますので、ここでは無効にします。現在、Azure portal を使用して、サブスクリプション レベルで Defender for IoT を有効にできます。Standard 階層は、最初の 30 日間は無料です。30 日を超える使用は[ここ](https://azure.microsoft.com/ja-jp/pricing/details/security-center/)で説明する価格スキームに従って自動的に課金されます。

1. 「_詳細設定_」で、**Device-to-cloud パーティション**が **4** に設定されていることを確認します。

    パーティションの数は、device-to-cloud メッセージの、同時読み取り数に関連しています。ほとんどの IoT ハブは、4 つのパーティション (既定値) のみが必要です。このコースでは、既定のパーティション数で IoT ハブを作成します。

1. ブレードの上部で、「**レビューと作成**」 をクリックします。

    設定した内容をレビューして確認します。

1. IoT ハブ の作成を完了するには、ブレードの下部で、「**作成**」 をクリックします。

    デプロイが完了するまでに 1 分以上かかることがあります。Azure portal の通知ウィンドウを開いて、進行状況を監視できます。

1. 数分後に、IoT ハブが **rg-az220** リソース グループに正常にデプロイされたことを示す通知が表示されます。

1. Azure portal メニューで 「**ダッシュボード**」 をクリックしてから、「**更新**」 をクリックします。

    リソース グループのタイルに新しい IoT ハブが表示されます。

### エクササイズ 3: IoT Hub サービスの確認

既に述べたとおり、IoT Hub は、クラウドでホストされるマネージド サービスで、IoT アプリケーションとそれが管理するデバイス間の双方向通信用の中央メッセージ ハブとして機能します。

IoT Hub の機能は、製造で使用される産業機器の管理、ヘルスケアの貴重な資産のトラッキング、オフィス ビルの使用状況の監視など、スケーラブルですべての機能を備えた IoT ソリューションの構築に役立ちます。IoT Hub の監視は、デバイスの作成、デバイスの障害、デバイスの接続などのイベントを追跡することで、ソリューションの正常性を維持するのに役立ちます。

#### タスク 1: IoT ハブの概要ブレードを確認する

1. 必要に応じて、Azure アカウントの認証情報を使用して [portal.azure.com](https://portal.azure.com) にログインします。

    複数の Azure アカウントをお持ちの場合は、このコースで使用するサブスクリプションに関連付けられているアカウントでログインしていることを確認してください。

1. AZ-220 ダッシュボードが表示されていることを確認します。

1. rg-az220 リソース グループ タイルで 「**iot-az220-training-{your-id}**」 をクリックします。

    IoT ハブを初めて開くと、 _概要_ ブレードが表示されます。ご覧のとおり、このブレードの上部にあるエリアには、データセンターの場所やサブスクリプションなど、IoT ハブ サービスに関する重要な情報が表示されます。ただし、このブレードには、ハブの使用方法と最近のアクティビティに関する情報を提供するタイルも含まれています。さらに探索する前に、これらのタイルを見てみましょう。

1. ブレードの左下で _概要_ ブレード、「**IoT ハブの使用状況**」タイルに注目してください。   

    > **注意**:  タイルはブラウザの幅に基づいてフローするため、レイアウトは説明とは少し異なる場合があります。

    このタイルは、ハブとメッセージ数に接続されている内容の概要を簡単に提供します。デバイスを追加してメッセージの送信を開始すると、このタイルは「一目でわかる」情報を提供します。

#### タスク 2: ナビゲーション メニューを使用して IoT ハブの機能を表示する

1. 「IoT ハブ ブレード」 で、左側のナビゲーション メニュー オプションを確認します。

    ご期待どおり、これらのオプションは、IoT ハブのプロパティと機能へのアクセスを提供するブレードを開きます。また、ハブに接続されているデバイスにアクセスすることもできます。

1. 左側のメニューの「**エクスプローラ**」で 「**IoT デバイス**」をクリックします。 

    このブレードを使用して、ハブに登録されているデバイスを追加、変更、および削除できます。このコースの終わりまでに、このブレードにかなり慣れます。

1. 左側のメニューの上部近くにある「**アクティビティ ログ**」をクリックします。

    名前が示すように、このブレードを使用すると、アクティビティの確認や問題の診断に使用できるログにアクセスできます。ルーチン タスクに役立つクエリを定義することもできます。非常に便利です。

1. 左側のメニューの「**設定**」で、「**組み込みのエンドポイント**」 をクリックします。 

    IoT ハブは、外部接続を有効にする 「エンドポイント」を公開します。基本的に、エンドポイントは IoT ハブに接続または通信するものです。ハブには、2 つのエンドポイントが既に定義されていることがわかります。

    * _イベント_
    * _cloud-to-deviceメッセージング_

1. 左側のメニューの 「**メッセージ**」 で、「**メッセージルーティング**」をクリックします。 

    IoT ハブのメッセージ ルーティング機能を使用すると、受信 device-to-cloud へのメッセージを、Azure Storage Containers、Event Hubs、Service Bus キューなどのサービス エンドポイントにルーティングできます。また、クエリ ベースのルートを実行するルーティング ルールを作成することもできます。

1. ブレードの上部にある**カスタム エンドポイント**をクリックします。

    カスタム エンドポイント (Service Bus キュー、Blob Storage、およびここに示されているその他のエンドポイントなど) は、IoT 実装内で頻繁に使用されます。

1. 「**設定**」の下のメニュー オプションを確認します。

    > **注意**:  このラボの演習は、IoT ハブ サービスの紹介であり、UI の使いやすさを高める目的だけなので、この時点で少し圧倒された場合でも心配しないでください。このコースを進めるにつれて、IoT ハブ、デバイス、および通信の構成と管理のプロセスについて説明します。

### 演習 4: Azure portal を使用して デバイス プロビジョニング サービスを作成する

Azure IoT Hub Device Provisioning Service は、人間の介入を必要とせずに、適切な IoT Hub に対してゼロタッチのJust-In-Time プロビジョニングを可能にする IoT Hub のヘルパー サービスです。デバイス プロビジョニング サービスでは、次の機能が提供されます。

* 工場出荷時に IoT Hub 接続情報をハードコーディングすることなく、単一の IoT ソリューションにゼロタッチ プロビジョニングを行う (初期設定)
* 複数のハブ間でデバイスを負荷分散
* 販売取引データに基づいてデバイスをオーナーのIoTソリューションに接続する (マルチテナント機能)
* ユースケースに応じた特定の IoTソリューションへのデバイスの接続 (ソリューション分離)
* 最短待機時間の IoT ハブへのデバイスの接続 (ジオ シャーディング)
* デバイスの変更に基づく再プロビジョニング
* IoT Hub への接続にデバイスで使用されるキーのロール (X.509 証明書を使用して接続しない場合)

IoT Hub Device Provisioning Service のインスタンスを作成するために使用できる方法はいくつかあります。たとえば、このタスクで使用する、Azure portal を使用できます。ただし、Azure CLI または Azure Resource Manager テンプレートを使用して DPS インスタンスを作成することもできます。

#### タスク 1: Azure portal を使用してリソースを作成する (デバイス プロビジョニング サービス)

1. 必要に応じて、Azure アカウントの認証情報を使用して [portal.azure.com](https://portal.azure.com) にログインします。

    複数の Azure アカウントをお持ちの場合は、このコースで使用するサブスクリプションに関連付けられているアカウントでログインしていることを確認してください。

1. Azure portal で、「**+ リソースの作成**」 をクリックします。

    Azure Marketplace は、Azure で作成できるすべてのリソースのコレクションです。Marketplace には、Microsoft とコミュニティの両方からのリソースが含まれています。

1. 「検索」 テキスト ボックスに、「**デバイス プロビジョニング サービス**」 と入力し、Enter を押します。 

1. 検索結果のブレードで、 「**IoT Hub デバイス プロビジョニング サービス**」 をクリックします。 

    このブレードに表示される「_役に立つリンク_」の一覧に注目してください。

1. リンクの一覧に、ドキュメントへのリンクがあることに注意してください。

    このドキュメントを今参照する必要はありませんが、このドキュメントが利用可能であることを知ることは良いことです。IoT Hub デバイス プロビジョニング サービス ドキュメント ページは、DPS のルート ページです。このページを使用して、現在のドキュメントを詳しく調査すると、このコースの範囲外のアクティビティを探索するのに役立つチュートリアルやその他のリソースを見つけることができます。特定のトピックの詳細については、このコースで docs.microsoft.com サイトを参照してください。

    ドキュメント リンクを開いた場合は、ブラウザーを使用してドキュメント タブを閉じ、Azure portal タブに戻ります。

#### タスク 2: 必要なプロパティ設定を使用してデバイス プロビジョニング サービスを作成する

1. 新しい DPS インスタンスの作成プロセスを開始するには、「**作成**」 をクリックします。 

    次に、ハブとサブスクリプションに関する情報を指定する必要があります。次の手順では、各フィールドの入力を説明しながら、設定をウォークスルーします。

1. 「**名前**」 ボックスに、デバイス プロビジョニング サービスの一意の名前を入力します。 

    一意の名前を指定するために、「**dps-az220-training-{your-id}**」と入力します。 

    例: **dps-az220-training-cah191216**

1. 「**サブスクリプション**」 で、このコースに使用しているサブスクリプションが選択されていることを確認します。

1. 「**リソース グループ**」 の下にある 「**既存の選択**」 ドロップダウンを開いてから、「**rg-az220**」 をクリックします。   

    これは、前のラボで作成したリソース グループです。このコースで作成したリソースを、同じリソース グループにまとめます。これは、コースを修了した時点でリソースをクリーンアップするのに役立ちます。

1. 「**場所**」 でドロップダウン リストを開き、リソース グループと同じリージョンを選択します。 

    以前、見たように、Azure は世界各地における一連のデータセンターでサポートされています。Azure で何かを作成する場合は、これらのデータセンターの場所のいずれかにデプロイします。

    > **注意**:  アプリをホストするデータセンターを選択する場合、エンド ユーザーに近いデータセンターを選択すると、読み込み/応答時間が短縮されます。エンド ユーザーから世界の反対側にいる場合は、最も近いデータセンターを選択しないでください。

1. ブレードの最下部で、**作成**をクリックします。

    デプロイが完了するまでに 1 分以上かかることがあります。Azure portal の通知ウィンドウを開いて、進行状況を監視できます。

1. 数分後に、IoT ハブ デバイス プロビジョニング サービス インスタンスが **rg-az220**リソース グループに正常にデプロイされたことを示す通知が表示されます。

1. Azure portal メニューで 「**ダッシュボード**」 をクリックしてから、「**更新**」 をクリックします。

    リソース グループのタイルに、新しい IoT ハブ デバイス プロビジョニング サービスが表示されるはずです。

#### タスク 3: IoT ハブとデバイス プロビジョニング サービスをリンクします。

1. AZ-220 ダッシュボードには、IoT ハブ リソースと DPS リソースの両方が表示されます。

    IoT ハブと DPS の両方のリソースが表示されます (リソースが最近作成された場合は、「**更新**」 をクリックする必要があります)

1. リソース グループ タイルで、「**dps-az220-training-{your-id}**」 をクリックします。

1. 「_デバイス プロビジョニング サービス_」 ブレードの 「**設定**」 で、「**リンク済み IoT ハブ**」 をクリックします。     

1. ブレードの上部にある 「**+ 追加**」 をクリックします。

    「IoT _Hub へのリンクの追加_」 ブレードを使用して、デバイス プロビジョニング サービス インスタンスを IoT ハブにリンクするために必要な情報を提供します。 

1. _IoT Hub へのリンクの追加_」 ブレードで、「**サブスクリプション**」 ドロップダウンにこのコースで使用しているサブスクリプションが表示されていることを確認します。   

    サブスクリプションは、使用可能な IoT ハブの一覧を提供するために使用されます。

1. IoT ハブのドロップダウンを開き、「**iot-az220-training-{your-id}**」 をクリックします。

    これは、前の演習で作成した IoT ハブです。

1. 「アクセス ポリシー」 ドロップダウンで 「**iothubowner**」 をクリックします。 

    _iothubowner_ 認証情報は、指定された IoT ハブとのリンクを確立するために必要なアクセス許可を提供します。 

1. 構成を完了するには、「**保存**」をクリックします。

    選択したハブが 「リンクされた IoT ハブ」 ブレードに表示されます。リンクされた IoT ハブを表示するには、「**最新の情報に更新**」 をクリックする必要がある場合があります。

1. Azure portal メニューで、**「ダッシュボード」** をクリックします。

### 演習 5: デバイス プロビジョニング サービスの確認

IoT Hub Device Provisioning Service は IoT Hub のヘルパー サービスであり、人間の介入を必要とせずに、適切な IoT Hub に対してゼロタッチの Just-In-Time プロビジョニングを可能にし、お客様が安全でスケーラブルな方法で何百万ものデバイスをプロビジョニングできるようにします。

#### タスク 1: 「デバイス プロビジョニング サービスの概要」ブレードを詳しく見る

1. 必要に応じて、Azure アカウントの認証情報を使用して [portal.azure.com](https://portal.azure.com) にログインします。

    複数の Azure アカウントをお持ちの場合は、このコースで使用するサブスクリプションに関連付けられているアカウントでログインしていることを確認してください。

1. AZ-220 ダッシュボードが表示されていることを確認します。

1. _rg-az220_ リソース グループ タイルで 「**dps-az220-training-{your-id}**」をクリックします。 

    デバイス プロビジョニング サービス インスタンスを初めて開くと、「_概要_」ブレードが表示されます。ご覧のとおり、このブレードの上部にあるエリアには、状態、データセンターの場所、サブスクリプションなど、DPS インスタンスに関する重要な情報が表示されます。このブレードには、次の項目にアクセスできる_クイック リンク_セクションもあります。

    * [Azure IoT Hub Device Provisioning Service のドキュメント](https://docs.microsoft.com/ja-jp/azure/iot-dps/)
    * [IoT Hub Device Provisioning Service の詳細](https://docs.microsoft.com/ja-jp/azure/iot-dps/about-iot-dps)
    * [デバイス プロビジョニングの概念](https://docs.microsoft.com/ja-jp/azure/iot-dps/concepts-service)
    * [価格とスケーリングの詳細](https://azure.microsoft.com/ja-jp/pricing/details/iot-hub/)

    詳細については、これらのリンクを参照してください。

#### タスク 2: ナビゲーション メニューを使用してデバイス プロビジョニング サービスの機能を表示する

1. 左側のナビゲーション エリアのオプションをスキャンするのに 1 分かかります。

    ご存知のように、これらのオプションは、DPS インスタンスのアクティビティ ログ、プロパティ、および機能へのアクセスを提供するブレードを開きます。

1. 左側のメニューの上部近くにある「**アクティビティ ログ**」をクリックします。

    名前が示すように、このブレードを使用すると、アクティビティの確認や問題の診断に使用できるログにアクセスできます。ルーチン タスクに役立つクエリを定義することもできます。非常に便利です。

1. 左側のナビゲーション領域の 「**設定**」、「**クイック スタート**」をクリックします。   

    このブレードには、Iot Hub Device Provisioning Service の使用を開始する手順、ドキュメントへのリンク、および DPS を構成するための他のブレードへのショートカットが表示されます。

1. 左側のナビゲーション エリアの、「**設定**」で「**共有アクセス ポリシー**」をクリックします。   

    このブレードでは、アクセス ポリシーの管理、既存のポリシー、および関連するアクセス許可の一覧が表示されます。

1. 左側のナビゲーション エリアの、「**設定**」で、「**リンク済み IoT hubs**」 をクリックします。

    ここには、以前からリンクされた IoT ハブを表示できます。デバイス プロビジョニング サービスは、デバイスにリンクされている IoT ハブにのみデバイスをプロビジョニングできます。IoT ハブを、デバイス プロビジョニング サービスのインスタンスにリンクさせると、サービスは IoT Hub のデバイス レジストリに対する読み取り/書き込みアクセス許可を付与します。リンクにより、デバイス プロビジョニング サービスはデバイス ID を登録し、デバイス ツインの初期構成を設定することができます。リンクされた IoT ハブは、どのAzure リージョンにも存在する可能性があります。他のサブスクリプションのハブを、プロビジョニング サービスにリンクすることができます。

1. ナビゲーションエリア左側で、**「設定」**の下にある、**「証明書」** をクリックします。

    ここでは、X.509 証明書認証を使用して Azure IoT Hub をセキュリティで保護するための、 X.509 証明書を管理することができます。後程ラボで、X.509 証明書について説明します。

1. ナビゲーション エリア左側で、 **「設定」** の下にある、 **「登録の管理」** をクリックします。

    ここでは、登録グループと個々の登録を管理することができます。

    登録グループは、必要な初期構成を共有する多数のデバイスに対して使用することも、すべて同じテナントに移動するデバイスに使用することもできます。登録グループは、特定の構成証明メカニズムを共有する、デバイスのグループです。登録グループは、X.509 と対称の両方をサポートします。X.509 登録グループ内のすべてのデバイスは、同じルートまたは中間認証機関 (CA) によって署名された X.509 証明書を提供します。対称キー登録グループ内の各デバイスは、グループ対称キーから派生した SAS トークンを提供します。登録グループ名と証明書名は、英数字、小文字でなければならず、ハイフンを含めることができます。

    個別登録は、登録できる単一のデバイスのエントリです。個別の登録では、X.509 リーフ証明書または SAS トークン (物理または仮想 TPM から) を証明メカニズムとして使用できます。個別の登録の登録 ID は英数字、小文字であり、ハイフンを含めることができます。個別の登録には、必要な IoT ハブ デバイス ID が指定されている場合があります。

1. 「**設定**」 の下の他のメニュー オプションをいくつか確認します。

   > **注意**:  このラボの演習は、IoT Hub デバイス プロビジョニング サービスの紹介であり、UI に慣れることだけが目的ですので、この時点で少し圧倒されたと感じても心配しないでください。コースが進むにつれて、DPS について詳しく説明します。
